syntax = "proto3";

package tradepulse.orderbook.v1;

option go_package = "github.com/TradePulse/TradePulse/libs/proto/gen/go/orderbook;orderbookpb";

import "google/protobuf/timestamp.proto";
import "libs/proto/market_data.proto";

message AnalyzeRequest {
  tradepulse.market.v1.OrderBook orderbook = 1;
  repeated tradepulse.market.v1.Trade recent_trades = 2;
}

message SpreadComponents {
  double effective_spread = 1;
  double adverse_selection = 2;
  double order_processing = 3;
  double inventory = 4;
}

message ToxicitySignal {
  double toxicity_score = 1;
  double obi = 2;
  SpreadComponents spread = 3;
  double price_impact = 4;
  string recommendation = 5;
  double confidence = 6;
  google.protobuf.Timestamp timestamp = 7;
}

message LargeOrderZone {
  double price = 1;
  double volume = 2;
  string side = 3;
  bool is_iceberg = 4;
}

message AnalyzeResponse {
  ToxicitySignal signal = 1;
  repeated LargeOrderZone large_orders = 2;
  double hidden_liquidity_estimate = 3;
}

service OrderBookAnalyzer {
  rpc Analyze(AnalyzeRequest) returns (AnalyzeResponse);
  rpc StreamAnalysis(stream AnalyzeRequest) returns (stream AnalyzeResponse);
}
